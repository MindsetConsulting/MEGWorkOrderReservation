sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Token","meg/workorder/utils/FilterUtil","meg/workorder/utils/CallUtil","sap/ui/model/FilterType"],function(e,t,r,o,i,n,a,l,s){"use strict";return e.extend("meg.workorder.controller.WorkOrder",{onInit:async function(){sap.ui.core.BusyIndicator.show();var e=new Date;var t=e.getFullYear()+""+(e.getMonth()+1)+""+e.getDate();e.setDate(e.getDate()-30);var r=e.getFullYear()+""+(e.getMonth()+1)+""+e.getDate();this.dateFilter="(Date ge '"+r+"' and Date le '"+t+"')";this.localModel=this.getOwnerComponent().getModel("localModel");this.WorkOrderModel=this.getOwnerComponent().getModel("WorkOrderModel");this.serviceUrl=this.WorkOrderModel.sServiceUrl;var o=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet?$format=json&$filter="+this.dateFilter);o=o.d.results;this.localModel.setProperty("/workOrderList",o);this.oFilterBar=this.getView().byId("FilterBar");this.oTable=this.getView().byId("workOrderTable")},onTableItemPress:function(e){var t=e.getSource().getBindingContextPath();var r=t.split("/")[1];var o=t.split("/")[2];var i=this.getView().getModel("localModel").getData()[r][o];var n=i.WorkOrder;this.localModel.setProperty("/selectedValues",i);var a=this.getOwnerComponent().getRouter();a.navTo("RouteObjectPage",{id:n})},handleValueHelpConfirm:function(e){var t=e.getParameters().id;var r=this.getInputId(t);var o=e.getParameter("selectedItems"),i=this.byId(r);if(o&&o.length>0){o.forEach(function(e){i.addToken(new n({text:e.getTitle()}))})}},getInputId:function(e){if(e=="workOrderVH"){return"woInput"}if(e=="plantVH"){return"plantInput"}if(e=="orderTypeVH"){return"orderTypeInput"}if(e=="plannerGroupVH"){return"plannerGroupInput"}if(e=="workCenterVH"){return"workCenterInput"}if(e=="funcLocVH"){return"funLocInput"}if(e=="equipmentVH"){return"equipmentInput"}},onResetFilters:function(){this.byId("woInput").removeAllTokens();this.byId("plantInput").removeAllTokens();this.byId("orderTypeInput").removeAllTokens();this.byId("plannerGroupInput").removeAllTokens();this.byId("workCenterInput").removeAllTokens();this.byId("funLocInput").removeAllTokens();this.byId("equipmentInput").removeAllTokens()},prepareGetCall:async function(e){var t=await l.callGetData(this.serviceUrl+e+"?$format=json");t=t.d.results;this.localModel.setProperty(e,t)},onWOValueHelp:async function(e){if(!this._oDialogWO){this._oDialogWO=sap.ui.xmlfragment("meg.workorder.fragments.WorkOrder",this);this.getView().addDependent(this._oDialogWO);this.VHID="WorkOrder";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_WORK_ORDER_F4Set",t);this._oDialogWO.open()}this.byId("woInput").removeAllTokens();this.VHID="WorkOrder";this._oDialogWO.open()},onPlantValueHelp:async function(e){if(!this._oDialogPlant){this._oDialogPlant=sap.ui.xmlfragment("meg.workorder.fragments.Plant",this);this.getView().addDependent(this._oDialogPlant);this.VHID="Plant";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_PLANT_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_PLANT_F4Set",t);this._oDialogPlant.open()}this.byId("plantInput").removeAllTokens();this.VHID="Plant";this._oDialogPlant.open()},onOrderTypeValueHelp:async function(e){if(!this._oDialogOrderType){this._oDialogOrderType=sap.ui.xmlfragment("meg.workorder.fragments.OrderType",this);this.getView().addDependent(this._oDialogOrderType);this.VHID="OrderType";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_ORDER_TYPE_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_ORDER_TYPE_F4Set",t);this._oDialogOrderType.open()}this.byId("orderTypeInput").removeAllTokens();this.VHID="OrderType";this._oDialogOrderType.open()},onPlannerGroupValueHelp:async function(e){if(!this._oDialogPlannerGroup){this._oDialogPlannerGroup=sap.ui.xmlfragment("meg.workorder.fragments.PlannerGroup",this);this.getView().addDependent(this._oDialogPlannerGroup);this.VHID="PlannerGroup";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_PLANNER_GROUP_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_PLANNER_GROUP_F4Set",t);this._oDialogPlannerGroup.open()}this.byId("plannerGroupInput").removeAllTokens();this.VHID="PlannerGroup";this._oDialogPlannerGroup.open()},onWorkCenterValueHelp:async function(e){if(!this._oDialogWorkCenter){this._oDialogWorkCenter=sap.ui.xmlfragment("meg.workorder.fragments.WorkCenter",this);this.getView().addDependent(this._oDialogWorkCenter);this.VHID="WorkCenter";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_CENTER_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_WORK_CENTER_F4Set",t);this._oDialogWorkCenter.open()}this.byId("workCenterInput").removeAllTokens();this.VHID="WorkCenter";this._oDialogWorkCenter.open()},onFuncLocValueHelp:async function(e){if(!this._oDialogFuncLoc){this._oDialogFuncLoc=sap.ui.xmlfragment("meg.workorder.fragments.FuncLoc",this);this.getView().addDependent(this._oDialogFuncLoc);this.VHID="FunctLocation";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_FUNCTION_LOCATION_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_FUNCTION_LOCATION_F4Set",t);this._oDialogFuncLoc.open()}this.byId("funLocInput").removeAllTokens();this.VHID="FunctLocation";this._oDialogFuncLoc.open()},onEquipmentValueHelp:async function(e){if(!this._oDialogEquipment){this._oDialogEquipment=sap.ui.xmlfragment("meg.workorder.fragments.Equipment",this);this.getView().addDependent(this._oDialogEquipment);this.VHID="Equipment";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_EQUIPMENT_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_EQUIPMENT_F4Set",t);this._oDialogEquipment.open()}this.byId("equipmentInput").removeAllTokens();this.VHID="Equipment";this._oDialogEquipment.open()},onFilterSearch:async function(){this.oTable.setShowOverlay(true);var e=this.oFilterBar.getFilterGroupItems().reduce(function(e,t){var r=t.getControl(),o=r._tokenizer.getAggregation("tokens"),i=t.getName(),n="";if(o.length>1){n="(";o.map(function(e){if(o.length!=o.length>1)n+=i+" eq '"+e.getText()+"' or "});n=n.slice(0,-4);n+=")"}else if(o.length==1){n=i+" eq '"+o[0].getText()+"'"}if(n&&n!==""){e.push(n)}return e},[]);var t=a.prepareFilters(e);var r=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet?$format=json&$filter="+t+this.dateFilter);r=r.d.results;this.localModel.setProperty("/workOrderList",r);this.oTable.setShowOverlay(false)},onValueHelpSearch:function(e){var t=e.getParameter("value");var r=new o(this.VHID,i.Contains,t);var n=e.getParameter("itemsBinding");n.filter([r])}})});
//# sourceMappingURL=WorkOrder.controller.js.map