sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Token","meg/workorder/utils/FilterUtil","meg/workorder/utils/CallUtil","sap/ui/model/FilterType"],function(e,t,r,o,a,i,n,l,s){"use strict";return e.extend("meg.workorder.controller.WorkOrder",{onInit:async function(){var e=new Date;var t=n.getFormattedDate(e);e.setDate(e.getDate()-30);var r=n.getFormattedDate(e);this.dateFilter="(Date ge '"+r+"' and Date le '"+t+"')";this.localModel=this.getOwnerComponent().getModel("localModel");this.WorkOrderModel=this.getOwnerComponent().getModel("WorkOrderModel");this.serviceUrl=this.WorkOrderModel.sServiceUrl;var o=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet?$format=json&$filter="+this.dateFilter);o=o.d.results;this.localModel.setProperty("/workOrderList",o);this.oTable=this.getView().byId("workOrderTable")},onTableItemPress:function(e){var t=e.getSource().getBindingContextPath();var r=t.split("/")[1];var o=t.split("/")[2];var a=this.getView().getModel("localModel").getData()[r][o];var i=a.WorkOrder;var n=this.getOwnerComponent().getRouter();n.navTo("RouteObjectPage",{id:i})},handleValueHelpConfirm:function(e){var t=e.getParameters().id;var r=this.getInputId(t);var o=e.getParameter("selectedItems"),a=this.byId(r);if(o&&o.length>0){o.forEach(function(e){a.addToken(new i({text:e.getTitle()}))})}},getInputId:function(e){if(e=="workOrderVH"){return"woInput"}if(e=="plantVH"){return"plantInput"}if(e=="orderTypeVH"){return"orderTypeInput"}if(e=="plannerGroupVH"){return"plannerGroupInput"}if(e=="workCenterVH"){return"workCenterInput"}if(e=="funcLocVH"){return"funLocInput"}if(e=="equipmentVH"){return"equipmentInput"}},onResetFilters:function(){this.byId("woInput").setValue("");this.byId("fromDate").setValue("");this.byId("toDate").setValue("");this.byId("woInput").removeAllTokens();this.byId("plantInput").removeAllTokens();this.byId("plantInput").setValue("");this.byId("orderTypeInput").removeAllTokens();this.byId("orderTypeInput").setValue("");this.byId("plannerGroupInput").removeAllTokens();this.byId("plannerGroupInput").setValue("");this.byId("workCenterInput").removeAllTokens();this.byId("workCenterInput").setValue("");this.byId("funLocInput").removeAllTokens();this.byId("funLocInput").setValue("");this.byId("equipmentInput").removeAllTokens();this.byId("equipmentInput").setValue("")},onWOValueHelp:async function(e){if(!this._oDialogWO){this._oDialogWO=sap.ui.xmlfragment("meg.workorder.fragments.WorkOrder",this);this.getView().addDependent(this._oDialogWO);this.VHID="WorkOrder";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_WORK_ORDER_F4Set",t);this.byId("woInput").setValue("");this._oDialogWO.open()}this.byId("woInput").setValue("");this.byId("woInput").removeAllTokens();this.VHID="WorkOrder";this._oDialogWO.open()},onPlantValueHelp:async function(e){if(!this._oDialogPlant){this._oDialogPlant=sap.ui.xmlfragment("meg.workorder.fragments.Plant",this);this.getView().addDependent(this._oDialogPlant);this.VHID="Plant";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_PLANT_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_PLANT_F4Set",t);this.byId("plantInput").setValue("");this._oDialogPlant.open()}this.byId("plantInput").setValue("");this.byId("plantInput").removeAllTokens();this.VHID="Plant";this._oDialogPlant.open()},onOrderTypeValueHelp:async function(e){if(!this._oDialogOrderType){this._oDialogOrderType=sap.ui.xmlfragment("meg.workorder.fragments.OrderType",this);this.getView().addDependent(this._oDialogOrderType);this.VHID="OrderType";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_ORDER_TYPE_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_ORDER_TYPE_F4Set",t);this.byId("orderTypeInput").setValue("");this._oDialogOrderType.open()}this.byId("orderTypeInput").setValue("");this.byId("orderTypeInput").removeAllTokens();this.VHID="OrderType";this._oDialogOrderType.open()},onPlannerGroupValueHelp:async function(e){if(!this._oDialogPlannerGroup){this._oDialogPlannerGroup=sap.ui.xmlfragment("meg.workorder.fragments.PlannerGroup",this);this.getView().addDependent(this._oDialogPlannerGroup);this.VHID="PlannerGroup";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_PLANNER_GROUP_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_PLANNER_GROUP_F4Set",t);this.byId("plannerGroupInput").setValue("");this._oDialogPlannerGroup.open()}this.byId("plannerGroupInput").setValue("");this.byId("plannerGroupInput").removeAllTokens();this.VHID="PlannerGroup";this._oDialogPlannerGroup.open()},onWorkCenterValueHelp:async function(e){if(!this._oDialogWorkCenter){this._oDialogWorkCenter=sap.ui.xmlfragment("meg.workorder.fragments.WorkCenter",this);this.getView().addDependent(this._oDialogWorkCenter);this.VHID="WorkCenter";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_CENTER_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_WORK_CENTER_F4Set",t);this.byId("workCenterInput").setValue("");this._oDialogWorkCenter.open()}this.byId("workCenterInput").setValue("");this.byId("workCenterInput").removeAllTokens();this.VHID="WorkCenter";this._oDialogWorkCenter.open()},onFuncLocValueHelp:async function(e){if(!this._oDialogFuncLoc){this._oDialogFuncLoc=sap.ui.xmlfragment("meg.workorder.fragments.FuncLoc",this);this.getView().addDependent(this._oDialogFuncLoc);this.VHID="FunctLocation";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_FUNCTION_LOCATION_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_FUNCTION_LOCATION_F4Set",t);this.byId("funLocInput").setValue("");this._oDialogFuncLoc.open()}this.byId("funLocInput").setValue("");this.byId("funLocInput").removeAllTokens();this.VHID="FunctLocation";this._oDialogFuncLoc.open()},onEquipmentValueHelp:async function(e){if(!this._oDialogEquipment){this._oDialogEquipment=sap.ui.xmlfragment("meg.workorder.fragments.Equipment",this);this.getView().addDependent(this._oDialogEquipment);this.VHID="Equipment";var t=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_EQUIPMENT_F4Set?$format=json");t=t.d.results;this.localModel.setProperty("/ZUSPPMEG01_EQUIPMENT_F4Set",t);this.byId("equipmentInput").setValue("");this._oDialogEquipment.open()}this.byId("equipmentInput").setValue("");this.byId("equipmentInput").removeAllTokens();this.VHID="Equipment";this._oDialogEquipment.open()},onFilterSearch:async function(){this.oTable.setShowOverlay(true);var e=this.byId("woInput").getProperty("value");var t=this.byId("plantInput").getProperty("value");var r=this.byId("orderTypeInput").getProperty("value");var o=this.byId("plannerGroupInput").getProperty("value");var a=this.byId("workCenterInput").getProperty("value");var i=this.byId("funLocInput").getProperty("value");var s=this.byId("equipmentInput").getProperty("value");var u=this.byId("fromDate").getDateValue();var p=this.byId("toDate").getDateValue();var d=this.getView().byId("FilterBar");var h=d.getFilterGroupItems().reduce(function(e,t){var r=t.getControl();if(r._tokenizer){var o=r._tokenizer.getAggregation("tokens")}var a=t.getName(),i="";if(o&&o.length>1){i="(";o.map(function(e){if(o.length!=o.length>1)i+=a+" eq '"+e.getText()+"' or "});i=i.slice(0,-4);i+=")"}else if(o&&o.length==1){i=a+" eq '"+o[0].getText()+"'"}if(i&&i!==""){e.push(i)}return e},[]);var g=n.prepareFilters(h);if(e!=""){if(g==""){g+="WorkOrder eq '"+e+"'"}else{g+=" and WorkOrder eq '"+e+"'"}}if(t!=""){if(g==""){g+="Plant eq '"+t+"'"}else{g+=" and Plant eq '"+t+"'"}}if(r!=""){if(g==""){g+="OrderType eq '"+r+"'"}else{g+=" and OrderType eq '"+r+"'"}}if(o!=""){if(g==""){g+="PlannerGroup eq '"+o+"'"}else{g+=" and PlannerGroup eq '"+o+"'"}}if(a!=""){if(g==""){g+="WorkCenter eq '"+a+"'"}else{g+=" and WorkCenter eq '"+a+"'"}}if(i!=""){if(g==""){g+="FunctLocation eq '"+i+"'"}else{g+=" and FunctLocation eq '"+i+"'"}}if(s!=""){if(g==""){g+="Equipment eq '"+s+"'"}else{g+=" and Equipment eq '"+s+"'"}}if(u&&p){if(g!=""){g+=" and "}u=n.getFormattedDate(u);p=n.getFormattedDate(p);this.dateFilter="(Date ge '"+u+"'"+" and Date le '"+p+"')"}else if(u){if(g!=""){g+=" and "}u=n.getFormattedDate(u);this.dateFilter="Date ge '"+u+"'"}else if(p){if(g!=""){g+=" and "}p=n.getFormattedDate(p);this.dateFilter="Date le '"+p+"'"}else{this.dateFilter=""}if(g==""&&this.dateFilter==""){var I=new Date;var m=n.getFormattedDate(I);I.setDate(I.getDate()-30);var c=n.getFormattedDate(I);this.dateFilter="(Date ge '"+c+"' and Date le '"+m+"')"}var D=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet?$format=json&$filter="+g+this.dateFilter);D=D.d.results;this.localModel.setProperty("/workOrderList",D);this.oTable.setShowOverlay(false)},onValueHelpSearch:function(e){var t=e.getParameter("value");var r=new o(this.VHID,a.Contains,t);var i=e.getParameter("itemsBinding");i.filter([r])}})});
//# sourceMappingURL=WorkOrder.controller.js.map