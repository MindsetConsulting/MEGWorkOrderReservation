sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","meg/workorder/utils/CallUtil"],function(e,t,r,a,o,l){"use strict";return e.extend("meg.workorder.controller.ObjectPage",{onInit:async function(){this.localModel=this.getOwnerComponent().getModel("localModel");var e=this.getOwnerComponent().getRouter();e.getRoute("RouteObjectPage").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:async function(e){sap.ui.core.BusyIndicator.show();this.WorkOrderId=e.getParameter("arguments").id;this.serviceUrl=this.getOwnerComponent().getModel("WorkOrderModel").sServiceUrl;var t="?$filter=WorkOrder eq '"+this.WorkOrderId+"'";var r="&$expand=OrdOperationNav,EquipBOMItemNav,AddPartItemNav";var a=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet"+t+r+"&$format=json");var o,s;if(a&&a.d.results.length>0){a=a.d.results[0];this.localModel.setProperty("/workOrderHeader",a);if(a&&a.OrdOperationNav){o=a.OrdOperationNav.results}if(a&&a.EquipBOMItemNav){this.getEquipBOMData(a.EquipBOMItemNav.results)}}this.localModel.setProperty("/orderOperations",o);this.localModel.setProperty("/AddPartsItems",[])},getEquipBOMData:async function(e){var t=this.getView().byId("equiBOMID");t.setShowOverlay(true);var r=this.serviceUrl;var a=this.localModel.getData().workOrderHeader.Plant;let o=0;for(o=0;o<e.length;o++){var s=e[o].Part;var i=await l.callGetData(r+"/ZUSPPMEG01_MATERIAL_STORAGE_LOCATIONSet?$filter=Part eq '"+s+"' and Plant eq '"+a+"'&$format=json");if(i&&i.d&&i.d.results){e[o].StorageLocation=i.d.results;if(i.d.results.length>1){e[o].isEnabled=true;e[o].isSelected=false}else{e[o].isEnabled=false;e[o].isSelected=true}}}this.localModel.setProperty("/equipBOMItems",e);t.setShowOverlay(false)},onAddPartValueHelp:async function(e){var t=e.getSource().oPropagatedProperties.oBindingContexts.localModel.sPath;this.valueHelpIndex=t.split("/")[2];if(!this._oDialogAddPart){this._oDialogAddPart=sap.ui.xmlfragment("meg.workorder.fragments.AdditionalPart",this);this.getView().addDependent(this._oDialogAddPart);this.VHID="WorkOrder";var r=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_PART_F4Set?$format=json");r=r.d.results;this.localModel.setProperty("/ZUSPPMEG01_PART_F4Set",r);this._oDialogAddPart.open()}this._oDialogAddPart.open()},onRowAddParts:function(){var e=this.localModel.getData();var t={Part:"",PartDesc:"",DesiredQuan:"",Operation:"",StorageLocation:"",isEnabled:false,isSelected:true};e.AddPartsItems.push(t);this.localModel.refresh()},onTableRowDelete:function(e){var t=e.getSource().oPropagatedProperties.oBindingContexts.localModel.sPath;var r=t.split("/")[2];var a=this.localModel.getData().AddPartsItems;a.splice(r,1);this.localModel.refresh()},handlePartConfirm:async function(e){var t=e.getParameter("selectedItem").getTitle();var r=e.getParameter("selectedItem").getDescription();var a=this.localModel.getData().workOrderHeader.Plant;var o=this.localModel.getData().AddPartsItems;var s=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_MATERIAL_STORAGE_LOCATIONSet?$filter=Part eq '"+t+"' and Plant eq '"+a+"'&$format=json");o[this.valueHelpIndex].Part=t;o[this.valueHelpIndex].PartDesc=r;o[this.valueHelpIndex].isEnabled=r;if(s&&s.d&&s.d.results){o[this.valueHelpIndex].StorageLocation=s.d.results;if(s.d.results.length>1){o[this.valueHelpIndex].isEnabled=true;o[this.valueHelpIndex].isSelected=false}else{o[this.valueHelpIndex].isEnabled=false;o[this.valueHelpIndex].isSelected=true}}this.localModel.refresh()},onValueHelpSearch:function(e){var t=e.getParameter("value");var r=new a("Part",o.Contains,t);var l=e.getParameter("itemsBinding");l.filter([r])},passWOReservation:function(e){var t=this.byId("equiBOMID");var r=t.getSelectedContextPaths();var a=this.localModel.getData();this.localModel.setProperty("/selectedEquiBOM",[]);if(r&&r.length>0){r.forEach(function(e){var t=e.split("/")[2];var r=a.equipBOMItems[t];a.selectedEquiBOM.push(r)})}var o={WorkOrder:a.workOrderHeader.WorkOrder,Plant:a.workOrderHeader.Plant,OrderType:a.workOrderHeader.OrderType,Description:a.workOrderHeader.Description,PlannerGroup:a.workOrderHeader.PlannerGroup,WorkCenter:a.workOrderHeader.WorkCenter,FunctLocation:a.workOrderHeader.FunctLocation,Equipment:a.workOrderHeader.Equipment,OrdOperationNav:a.OrdOperationNav.results,EquipBOMItemNav:a.selectedEquiBOM,AddPartItemNav:a.AddPartsItems};console.log(o)}})});
//# sourceMappingURL=ObjectPage.controller.js.map