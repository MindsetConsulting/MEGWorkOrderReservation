sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Token","meg/workorder/utils/FilterUtil","meg/workorder/utils/CallUtil","sap/ui/model/FilterType"],function(e,t,o,r,i,n,a,l,s){"use strict";return e.extend("meg.workorder.controller.WorkOrder",{onInit:async function(){sap.ui.core.BusyIndicator.show();var e=new Date;var t=e.getFullYear()+""+(e.getMonth()+1)+""+e.getDate();e.setDate(e.getDate()-30);var o=e.getFullYear()+""+(e.getMonth()+1)+""+e.getDate();this.dateFilter="(Date ge '"+o+"' and Date le '"+t+"')";this.serviceUrl=this.getOwnerComponent().getModel("WorkOrderModel").sServiceUrl;var r=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet?$format=json&$filter="+this.dateFilter);r=r.d.results;this.localModel=this.getOwnerComponent().getModel("localModel");this.localModel.setProperty("/workOrderList",r);this.localModel.setProperty("/filterValues",{});this.oFilterBar=this.getView().byId("FilterBar");this.oTable=this.getView().byId("workOrderTable")},onTableItemPress:function(e){var t=e.getSource().getBindingContextPath();var o=t.split("/")[1];var r=t.split("/")[2];var i=this.getView().getModel("localModel").getData()[o][r];var n=i.WorkOrder;this.localModel.setProperty("/selectedValues",i);var a=this.getOwnerComponent().getRouter();a.navTo("RouteObjectPage",{id:n})},handleValueHelpConfirm:function(e){var t=e.getParameters().id;var o=this.getInputId(t);var r=e.getParameter("selectedItems"),i=this.byId(o);if(r&&r.length>0){r.forEach(function(e){i.addToken(new n({text:e.getTitle()}))})}},getInputId:function(e){if(e=="workOrderVH"){return"woInput"}if(e=="plantVH"){return"plantInput"}if(e=="orderTypeVH"){return"orderTypeInput"}if(e=="plannerGroupVH"){return"plannerGroupInput"}if(e=="workCenterVH"){return"workCenterInput"}if(e=="funcLocVH"){return"funLocInput"}if(e=="equipmentVH"){return"equipmentInput"}},onResetFilters:function(){this.byId("woInput").removeAllTokens();this.byId("plantInput").removeAllTokens();this.byId("orderTypeInput").removeAllTokens();this.byId("plannerGroupInput").removeAllTokens();this.byId("workCenterInput").removeAllTokens();this.byId("funLocInput").removeAllTokens();this.byId("equipmentInput").removeAllTokens()},onWOValueHelp:function(e){if(!this._oDialogWO){this._oDialogWO=sap.ui.xmlfragment("meg.workorder.fragments.WorkOrder",this);this.getView().addDependent(this._oDialogWO);this.VHID="WorkOrder";this._oDialogWO.open()}this.VHID="WorkOrder";this._oDialogWO.open()},onPlantValueHelp:function(e){if(!this._oDialogPlant){this._oDialogPlant=sap.ui.xmlfragment("meg.workorder.fragments.Plant",this);this.getView().addDependent(this._oDialogPlant);this.VHID="Plant";this._oDialogPlant.open()}this.VHID="Plant";this._oDialogPlant.open()},onOrderTypeValueHelp:function(e){if(!this._oDialogOrderType){this._oDialogOrderType=sap.ui.xmlfragment("meg.workorder.fragments.OrderType",this);this.getView().addDependent(this._oDialogOrderType);this.VHID="OrderType";this._oDialogOrderType.open()}this.VHID="OrderType";this._oDialogOrderType.open()},onPlannerGroupValueHelp:function(e){if(!this._oDialogPlannerGroup){this._oDialogPlannerGroup=sap.ui.xmlfragment("meg.workorder.fragments.PlannerGroup",this);this.getView().addDependent(this._oDialogPlannerGroup);this.VHID="PlannerGroup";this._oDialogPlannerGroup.open()}this.VHID="PlannerGroup";this._oDialogPlannerGroup.open()},onWorkCenterValueHelp:function(e){if(!this._oDialogWorkCenter){this._oDialogWorkCenter=sap.ui.xmlfragment("meg.workorder.fragments.WorkCenter",this);this.getView().addDependent(this._oDialogWorkCenter);this.VHID="WorkCenter";this._oDialogWorkCenter.open()}this.VHID="WorkCenter";this._oDialogWorkCenter.open()},onFuncLocValueHelp:function(e){if(!this._oDialogFuncLoc){this._oDialogFuncLoc=sap.ui.xmlfragment("meg.workorder.fragments.FuncLoc",this);this.getView().addDependent(this._oDialogFuncLoc);this.VHID="FunctLocation";this._oDialogFuncLoc.open()}this.VHID="FunctLocation";this._oDialogFuncLoc.open()},onEquipmentValueHelp:function(e){if(!this._oDialogEquipment){this._oDialogEquipment=sap.ui.xmlfragment("meg.workorder.fragments.Equipment",this);this.getView().addDependent(this._oDialogEquipment);this.VHID="Equipment";this._oDialogEquipment.open()}this.VHID="Equipment";this._oDialogEquipment.open()},onFilterSearch:async function(){this.oTable.setShowOverlay(true);var e=this.oFilterBar.getFilterGroupItems().reduce(function(e,t){var o=t.getControl(),r=o._tokenizer.getAggregation("tokens"),i=t.getName(),n="";if(r.length>1){n="(";r.map(function(e){if(r.length!=r.length>1)n+=i+" eq '"+e.getText()+"' or "});n=n.slice(0,-4);n+=")"}else if(r.length==1){n=i+" eq '"+r[0].getText()+"'"}if(n&&n!==""){e.push(n)}return e},[]);var t=a.prepareFilters(e);var o=await l.callGetData(this.serviceUrl+"/ZUSPPMEG01_WORK_ORDER_HEADERSet?$format=json&$filter="+t+this.dateFilter);o=o.d.results;this.localModel.setProperty("/workOrderList",o);this.oTable.setShowOverlay(false)},onValueHelpSearch:function(e){var t=e.getParameter("value");var o=new r(this.VHID,i.Contains,t);var n=e.getParameter("itemsBinding");n.filter([o])}})});
//# sourceMappingURL=WorkOrder.controller.js.map